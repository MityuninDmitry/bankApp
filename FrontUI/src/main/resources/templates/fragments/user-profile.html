<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<!-- Блок с информацией о пользователе -->
<div th:fragment="userProfile(userDto)" th:if="${userDto != null}" style="border: 1px solid black; padding: 10px; margin: 10px 0;">
  <h3>User Profile</h3>
  <p>
    <strong>Login:</strong>
    <span th:text="${userDto.login}"></span>
  <form th:action="@{/delete}" method="post" style="display: inline;">
    <button type="submit" style="margin-left: 10px; color: white; background-color: #f44336; border: none; padding: 2px 5px; border-radius: 3px; cursor: pointer;">
      Delete Account
    </button>
  </form>
  </p>

  <!-- Форма для изменения информации пользователя -->
  <div style="margin-top: 20px;">
    <h4>Edit Profile Information</h4>
    <form th:action="@{/update/userInfo}" method="post">
      <input type="hidden" name="login" th:value="${userDto.login}">

      <div style="margin-bottom: 10px;">
        <label for="firstName">First Name:</label>
        <input type="text" id="firstName" name="firstName" th:value="${userDto.firstName}"
               style="padding: 5px; width: 200px;">
      </div>

      <div style="margin-bottom: 10px;">
        <label for="lastName">Last Name:</label>
        <input type="text" id="lastName" name="lastName" th:value="${userDto.lastName}"
               style="padding: 5px; width: 200px;">
      </div>

      <div style="margin-bottom: 10px;">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" th:value="${userDto.email}"
               style="padding: 5px; width: 200px;">
      </div>

      <div style="margin-bottom: 10px;">
        <label for="birthDate">Birth Date (yyyy-MM-dd):</label>
        <input type="date" id="birthDate" name="birthDate"
               th:value="${userDto.birthDate != null} ? ${#temporals.format(userDto.birthDate, 'yyyy-MM-dd')} : ''"
               style="padding: 5px; width: 200px;">
      </div>

      <!-- Секция для счетов -->
      <div style="margin: 20px 0; border-top: 1px solid #eee; padding-top: 10px;">
        <h4>Payment Accounts</h4>
        <div th:if="${userDto.paymentAccounts != null && !userDto.paymentAccounts.isEmpty()}">
          <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
            <thead>
            <tr style="background-color: #f2f2f2;">
              <th style="padding: 8px; border: 1px solid #ddd;">Account Number</th>
              <th style="padding: 8px; border: 1px solid #ddd;">Currency</th>
              <th style="padding: 8px; border: 1px solid #ddd;">Balance</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="account : ${userDto.paymentAccounts}" style="border-bottom: 1px solid #ddd;">
              <td style="padding: 8px; border: 1px solid #ddd;" th:text="${account.accountNumber}"></td>
              <td style="padding: 8px; border: 1px solid #ddd;" th:text="${account.currency}"></td>
              <td style="padding: 8px; border: 1px solid #ddd; text-align: right;"
                  th:text="${#numbers.formatDecimal(account.balance, 1, 2)}"></td>
            </tr>
            </tbody>
          </table>
        </div>
        <div th:unless="${userDto.paymentAccounts != null && !userDto.paymentAccounts.isEmpty()}">
          <p>No payment accounts yet.</p>
        </div>
      </div>

      <button type="submit" style="color: white; background-color: #4CAF50; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">
        Update Profile
      </button>

      <span th:if="${userInfoUpdated}" style="color: green; margin-left: 10px;">Profile updated successfully!</span>
      <span th:if="${userInfoUpdatedError}" style="color: red; margin-left: 10px;" th:text="${userInfoUpdatedError}"></span>
    </form>
  </div>

  <!-- Форма для изменения пароля -->
  <div style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 10px;">
    <h4>Change Password</h4>
    <form th:action="@{/update/password}" method="post">
      <input type="hidden" name="login" th:value="${userDto.login}">
      <div style="margin-bottom: 10px;">
        <label for="password">New Password:</label>
        <input type="password" id="password" name="password" required style="padding: 5px; width: 200px;">
      </div>
      <button type="submit" style="color: white; background-color: #4CAF50; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">
        Update Password
      </button>
      <span th:if="${passwordUpdated}" style="color: green; margin-left: 10px;">Password updated successfully!</span>
      <span th:if="${passwordError}" style="color: red; margin-left: 10px;" th:text="${passwordError}"></span>
    </form>
  </div>
</div>

<div th:fragment="notAuthenticated" th:if="${userDto == null}">
  <p>Please <a href="/login">log in</a> to view your profile.</p>
</div>
</body>
</html>